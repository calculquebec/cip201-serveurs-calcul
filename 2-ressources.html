
<!DOCTYPE html>


<html lang="fr" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Bien choisir les ressources &#8212; CIP201 - Maîtriser l’utilisation des serveurs de calcul</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/documentation_options.js?v=72dce1d2"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="_static/translations.js?v=041d0952"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '2-ressources';</script>
    <link rel="icon" href="_static/logo.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="Lots de tâches" href="3-lots-taches.html" />
    <link rel="prev" title="Introduction" href="1-introduction.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="fr"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="0-a_propos.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="CIP201 - Maîtriser l’utilisation des serveurs de calcul - Home"/>
    <img src="_static/logo.png" class="logo__image only-dark pst-js-only" alt="CIP201 - Maîtriser l’utilisation des serveurs de calcul - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Recherche</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="0-a_propos.html">
                    Maîtriser les systèmes de calculs de l’Alliance
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="1-introduction.html">Introduction</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Bien choisir les ressources</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-lots-taches.html">Lots de tâches</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-stockage.html">Les espaces de stockage</a></li>
<li class="toctree-l1"><a class="reference internal" href="90-exercices.html">Exercices supplémentaires</a></li>
<li class="toctree-l1"><a class="reference internal" href="99-references.html">Références</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/calculquebec/cip201-serveurs-calcul" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Dépôt source"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Téléchargez cette page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/2-ressources.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Télécharger le fichier source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Imprimer au format PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Mode plein écran"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Bien choisir les ressources</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contenu </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectif-construction-d-un-script-de-tache-slurm">Objectif - construction d’un script de tâche Slurm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analyse-des-calculs-localement">Analyse des calculs localement</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sous-windows">Sous Windows</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sous-macos">Sous macOS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sous-linux">Sous Linux</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analyse-des-taches-sur-la-grappe-de-calcul">Analyse des tâches sur la grappe de calcul</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ressources-utilisees-d-une-tache-terminee">Ressources utilisées d’une tâche terminée</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ressources-utilisees-par-une-tache-cpu-en-cours">Ressources utilisées par une tâche CPU en cours</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exercice-valider-le-comportement-d-une-tache-active"><strong>Exercice</strong> - Valider le comportement d’une tâche active</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#demo-ressources-utilisees-par-une-tache-gpu-en-cours">(Démo) Ressources utilisées par une tâche GPU en cours</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exercice-tester-crunch-py-avec-un-gpu"><strong>Exercice</strong> - Tester <code class="docutils literal notranslate"><span class="pre">crunch.py</span></code> avec un GPU</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#comparer-la-vitesse-cpu-vs-gpu">Comparer la vitesse CPU vs GPU</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analyse-des-taches-via-les-portails">Analyse des tâches via les portails</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimer-les-ressources-necessaires">Estimer les ressources nécessaires</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#efficacite-cible-d-une-tache">Efficacité cible d’une tâche</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exercice-efficacite-des-taches"><strong>Exercice</strong> - Efficacité des tâches</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extrapoler-les-ressources-necessaires">Extrapoler les ressources nécessaires</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#taille-des-donnees-et-nombre-de-fichiers-a-traiter">Taille des données et nombre de fichiers à traiter</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparaison-entre-les-grappes-de-calcul">Comparaison entre les grappes de calcul</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#points-a-retenir">Points à retenir</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="bien-choisir-les-ressources">
<h1>Bien choisir les ressources<a class="headerlink" href="#bien-choisir-les-ressources" title="Lien vers cette rubrique">#</a></h1>
<p>Il y a plusieurs <strong>ressources de calcul haute performance</strong> qui vous
sont disponibles à l’Alliance de recherche numérique du Canada :</p>
<ul class="simple">
<li><p>Grappes de calcul :</p>
<ul>
<li><p>Béluga, Cedar, Graham, Narval, Niagara</p></li>
</ul>
</li>
<li><p>Stockage :</p>
<ul>
<li><p>Temporaire, projet, <em>nearline</em></p></li>
</ul>
</li>
</ul>
<p>Malgré qu’elles soient grandes, tout en ayant une taille limitée,
ces ressources devraient être utilisées parcimonieusement par
chaque personne afin de maximiser la quantité de résultats
scientifiques produits pour soi-même et pour les autres.</p>
<section id="objectif-construction-d-un-script-de-tache-slurm">
<h2>Objectif - construction d’un script de tâche Slurm<a class="headerlink" href="#objectif-construction-d-un-script-de-tache-slurm" title="Lien vers cette rubrique">#</a></h2>
<p>Le principal objectif de ce chapitre est de vous permettre d’analyser
vos besoins dans le but de <strong>déterminer les ressources nécessaires</strong>
pour vos tâches de calcul.
Chaque tâche de calcul est définie par un <strong>script de tâche</strong> destiné à
<a class="reference external" href="https://slurm.schedmd.com/documentation.html">l’ordonnanceur Slurm</a>.
Typiquement écrit en commandes Bash, on y retrouve :</p>
<ul class="simple">
<li><p>Le <a class="reference external" href="https://fr.wikipedia.org/wiki/Shebang">shebang</a> en toute
première ligne. Par exemple : <code class="docutils literal notranslate"><span class="pre">#!/bin/bash</span></code></p></li>
<li><p>Les options <code class="docutils literal notranslate"><span class="pre">#SBATCH</span></code> en entête pour les besoins de la tâche. Les
options en entête seront lues par la commande de soumission de tâche
<a class="reference external" href="https://slurm.schedmd.com/sbatch.html"><code class="docutils literal notranslate"><span class="pre">sbatch</span></code></a></p></li>
<li><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Utiliser_des_modules">Chargement des modules</a> requis</p></li>
<li><p>Les commandes Bash qui seront exécutées automatiquement sur des
processeurs réservés pour la tâche</p></li>
</ul>
<p>Par exemple : <a class="reference external" href="https://github.com/calculquebec/cip201-serveurs-calcul/blob/main/scripts/mpi-allo.sh"><code class="docutils literal notranslate"><span class="pre">scripts/mpi-allo.sh</span></code></a></p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>scripts/mpi-allo.sh
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --ntasks=10</span>
<span class="c1">#SBATCH --mem-per-cpu=1000M</span>
<span class="c1">#SBATCH --time=0-00:10</span>

<span class="n">module</span> <span class="n">load</span> <span class="n">gcc</span><span class="o">/</span><span class="mf">12.3</span> <span class="o">&amp;&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>

<span class="n">mpirun</span> <span class="n">printenv</span> <span class="n">HOSTNAME</span> <span class="n">OMPI_COMM_WORLD_RANK</span> <span class="n">OMPI_COMM_WORLD_SIZE</span>
</pre></div>
</div>
<p>Notre documentation à cet effet débute à la page :
<a class="reference external" href="https://docs.alliancecan.ca/wiki/Running_jobs/fr">Exécuter des tâches</a></p>
</section>
<section id="analyse-des-calculs-localement">
<h2>Analyse des calculs localement<a class="headerlink" href="#analyse-des-calculs-localement" title="Lien vers cette rubrique">#</a></h2>
<p>Lorsqu’une tâche est en cours d’exécution sur votre ordinateur,
vous pouvez surveiller différentes métriques :</p>
<ul class="simple">
<li><p>Utilisation CPU (et GPU, s’il y a lieu)</p></li>
<li><p>Mémoire-vive utilisée</p></li>
<li><p>Accès au stockage (lectures et écritures par seconde, bande-passante)</p></li>
</ul>
<section id="sous-windows">
<h3>Sous Windows<a class="headerlink" href="#sous-windows" title="Lien vers cette rubrique">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://fr.wikipedia.org/wiki/Gestionnaire_des_t%C3%A2ches_Windows">Gestionnaire des tâches Windows</a></p></li>
<li><p>Pour le faire afficher, on le trouve de deux manières :</p>
<ul>
<li><p>Chercher <em>Gestionnaire des tâches</em> dans le menu Démarrer</p></li>
<li><p>Raccourcis clavier Ctrl+Alt+Suppr</p></li>
</ul>
</li>
</ul>
<p><img alt="Aperçu du gestionnaire des tâches Windows" src="_images/win-task-manager.png" /></p>
</section>
<section id="sous-macos">
<h3>Sous macOS<a class="headerlink" href="#sous-macos" title="Lien vers cette rubrique">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://support.apple.com/fr-ca/guide/activity-monitor/actmntr1001/mac">Moniteur d’activité</a></p></li>
<li><p>Pour le faire afficher :</p>
<ul>
<li><p>Démarrer l’application à partir des <em>Applications et Utilitaires</em> de macOS</p></li>
<li><p>Sinon, utiliser le raccourcis clavier Commande+Espace et taper les
premières lettres de « Moniteur d’activité » pour pouvoir sélectionner
cette application</p></li>
</ul>
</li>
</ul>
<p><img alt="Aperçu du moniteur d'activité macOS" src="https://help.apple.com/assets/5FDCF1894EB74318147EC0CF/5FDCF18A4EB74318147EC0D6/fr_CA/ad6337d66061aa27122e75521960fc5a.png" />
<em>Image tirée du soutien technique d’Apple</em></p>
</section>
<section id="sous-linux">
<h3>Sous Linux<a class="headerlink" href="#sous-linux" title="Lien vers cette rubrique">#</a></h3>
<p>Dans un terminal Unix, on peut utiliser :</p>
<ul class="simple">
<li><p>La <a class="reference external" href="https://man7.org/linux/man-pages/man1/top.1.html">commande <code class="docutils literal notranslate"><span class="pre">top</span></code></a>
(appuyez sur Q pour quitter)</p></li>
</ul>
<p><img alt="Capture de top" src="_images/linux-top.png" /></p>
<ul class="simple">
<li><p>La <a class="reference external" href="https://man7.org/linux/man-pages/man1/htop.1.html">commande <code class="docutils literal notranslate"><span class="pre">htop</span></code></a>
(appuyez sur Q pour quitter)</p></li>
</ul>
<p><img alt="Capture de htop" src="_images/linux-htop.png" /></p>
</section>
</section>
<section id="analyse-des-taches-sur-la-grappe-de-calcul">
<h2>Analyse des tâches sur la grappe de calcul<a class="headerlink" href="#analyse-des-taches-sur-la-grappe-de-calcul" title="Lien vers cette rubrique">#</a></h2>
<p>On commence par <strong>se connecter au noeud frontal</strong> de la grappe :</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>ssh<span class="w"> </span>login1
...
</pre></div>
</div>
<p><strong>Notes</strong> :</p>
<ul class="simple">
<li><p>Pour accéder aux grappes de calcul en production, il vaut mieux
utiliser <a class="reference external" href="https://docs.alliancecan.ca/wiki/Using_SSH_keys_in_Linux/fr">une paire de clés SSH</a>.</p></li>
<li><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Multifactor_authentication/fr">L’authentification multifacteur</a>
est maintenant obligatoire sur les grappes nationales.
<a class="reference external" href="https://www.youtube.com/watch?v=ciycOUbchl8">Vidéo d’introduction ici</a>.</p></li>
<li><p>Avec votre accès par défaut, vous avez un compte de calcul
<code class="docutils literal notranslate"><span class="pre">def-*</span></code> de base qui vous permet de lancer des tâches.</p></li>
</ul>
<p>Pour soumettre un script de tâche, on utilise la
<a class="reference external" href="https://slurm.schedmd.com/sbatch.html">commande <code class="docutils literal notranslate"><span class="pre">sbatch</span></code></a> :</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sbatch<span class="w"> </span>scripts/blastn-gen-seq.sh
</pre></div>
</div>
<p>Et pour voir l’état de la tâche, on utilise la
<a class="reference external" href="https://slurm.schedmd.com/squeue.html">commande <code class="docutils literal notranslate"><span class="pre">squeue</span></code></a> :</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>squeue<span class="w"> </span>-u<span class="w"> </span><span class="nv">$USER</span><span class="w">  </span><span class="c1"># ou &#39;sq&#39;</span>
</pre></div>
</div>
<section id="ressources-utilisees-d-une-tache-terminee">
<h3>Ressources utilisées d’une tâche terminée<a class="headerlink" href="#ressources-utilisees-d-une-tache-terminee" title="Lien vers cette rubrique">#</a></h3>
<p>Avec la <a class="reference external" href="https://slurm.schedmd.com/sacct.html">commande <code class="docutils literal notranslate"><span class="pre">sacct</span></code></a>,
on peut obtenir un tableau détaillé de nos tâches exécutées
depuis minuit :</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sacct
</pre></div>
</div>
<p>Avec la <a class="reference external" href="https://docs.alliancecan.ca/wiki/Running_jobs/fr#T.C3.A2ches_termin.C3.A9es">commande <code class="docutils literal notranslate"><span class="pre">seff</span></code></a>,
on peut obtenir un court rapport d’exécution d’une tâche.
Ce rapport inclut une mesure du temps écoulé, une mesure du temps CPU
et une mesure de consommation maximale de la mémoire-vive.
Des valeurs d’efficacité en pourcentages sont données pour les cycles CPU
et la mémoire-vives en fonction des quantités réservées.</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>seff<span class="w"> </span>&lt;No_tâche&gt;
</pre></div>
</div>
</section>
<section id="ressources-utilisees-par-une-tache-cpu-en-cours">
<h3>Ressources utilisées par une tâche CPU en cours<a class="headerlink" href="#ressources-utilisees-par-une-tache-cpu-en-cours" title="Lien vers cette rubrique">#</a></h3>
<p>Étant donné un certain calcul matriciel dans le script Python
<a class="reference external" href="https://github.com/calculquebec/cip201-serveurs-calcul/blob/main/scripts/crunch.py"><code class="docutils literal notranslate"><span class="pre">scripts/crunch.py</span></code></a> :</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>scripts/crunch.py
</pre></div>
</div>
<p>Lors d’une tâche interactive, on peut utiliser <code class="docutils literal notranslate"><span class="pre">top</span></code> et <code class="docutils literal notranslate"><span class="pre">htop</span></code> pour surveiller les ressources utilisées :</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tâche interactive</span>
salloc<span class="w"> </span>--cpus-per-task<span class="o">=</span><span class="m">4</span><span class="w"> </span>--mem<span class="o">=</span>8000M<span class="w"> </span>--time<span class="o">=</span><span class="m">0</span>:15:0

cat<span class="w"> </span>scripts/crunch.sh

<span class="c1"># Exécution avec un (1) processeur</span>
bash<span class="w"> </span>scripts/crunch.sh<span class="w"> </span>--cpu<span class="w"> </span><span class="m">1</span>
top<span class="w"> </span>-u<span class="w"> </span><span class="nv">$USER</span><span class="w">  </span><span class="c1"># q pour quitter</span>

<span class="c1"># Exécution avec quatre (4) processeurs</span>
bash<span class="w"> </span>scripts/crunch.sh<span class="w"> </span>--cpu<span class="w"> </span><span class="m">4</span>
htop<span class="w"> </span>-u<span class="w"> </span><span class="nv">$USER</span><span class="w">  </span><span class="c1"># q pour quitter</span>

<span class="c1"># Comparer les résultats</span>
grep<span class="w"> </span>sec<span class="w"> </span>*.log

<span class="nb">exit</span><span class="w">  </span><span class="c1"># Pour revenir à login1</span>
</pre></div>
</div>
<p>Si vous utilisez
<a class="reference external" href="https://docs.alliancecan.ca/wiki/JupyterHub/fr">JupyterHub</a>
pour profiler votre programme, vous pouvez visualiser en temps
réel la consommation de ressources dans l’onglet <em>GPU Dashboards</em>:</p>
<p><img alt="NV Dashboard CPU" src="_images/nv-dashboard_cpu.png" /></p>
<section id="exercice-valider-le-comportement-d-une-tache-active">
<h4><strong>Exercice</strong> - Valider le comportement d’une tâche active<a class="headerlink" href="#exercice-valider-le-comportement-d-une-tache-active" title="Lien vers cette rubrique">#</a></h4>
<p>Pendant que vos tâches sont actives, vous pouvez vous connecter par
SSH aux noeuds de calcul correspondants afin de valider que
l’exécution se passe bien :</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>scripts/inv-mat.sh
sbatch<span class="w"> </span>scripts/inv-mat.sh
</pre></div>
</div>
<p>Voici les étapes de validation (à adapter pour l’exercice) :</p>
<ul class="simple">
<li><p>Identification du ou des noeud(s) avec : <code class="docutils literal notranslate"><span class="pre">squeue</span> <span class="pre">-u</span> <span class="pre">$USER</span></code></p></li>
<li><p>Connexion avec : <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">&lt;nom_noeud&gt;</span></code></p></li>
<li><p>Inspection avec <code class="docutils literal notranslate"><span class="pre">top</span></code> et/ou <code class="docutils literal notranslate"><span class="pre">htop</span></code> :</p>
<ul>
<li><p>Est-ce que vos processus s’exécutent avec un <strong>pourcentage de 100%?</strong></p></li>
<li><p>Est-ce que vos processus parallèles s’exécutent avec un
<strong>pourcentage de <span class="math notranslate nohighlight">\(n\)</span> * 100%</strong>, où <span class="math notranslate nohighlight">\(n\)</span> est le nombre de processeurs
par tâche Slurm?</p></li>
<li><p>Est-ce que le <strong>noeud de calcul</strong> semble pleinement utilisé?</p></li>
</ul>
</li>
<li><p><strong>Inspection des résultats</strong> dans <code class="docutils literal notranslate"><span class="pre">temps_inv.csv</span></code></p>
<ul>
<li><p>Identifier tout problème, s’il y a lieu; trouver la cause</p></li>
<li><p>Corriger le code source, la compilation, le script ou les
paramètres de la tâche de calcul</p></li>
<li><p>Relancer la tâche de calcul et refaire les précédentes étapes</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="demo-ressources-utilisees-par-une-tache-gpu-en-cours">
<h3>(Démo) Ressources utilisées par une tâche GPU en cours<a class="headerlink" href="#demo-ressources-utilisees-par-une-tache-gpu-en-cours" title="Lien vers cette rubrique">#</a></h3>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tâche interactive</span>
salloc<span class="w"> </span>--cpus-per-task<span class="o">=</span><span class="m">4</span><span class="w"> </span>--mem<span class="o">=</span>8000M<span class="w"> </span>--time<span class="o">=</span><span class="m">0</span>:15:0<span class="w"> </span>--gres<span class="o">=</span>gpu:1
</pre></div>
</div>
<ul class="simple">
<li><p>Pour Windows et macOS, il existe des outils propriétaires
permettant de visualiser en temps réel l’utilisation du GPU.
Veuillez vous référer au site Web du manufacturier de votre GPU
pour les détails</p></li>
<li><p>Sous Linux, il y a d’abord la
<a class="reference external" href="https://developer.nvidia.com/nvidia-system-management-interface">commande <code class="docutils literal notranslate"><span class="pre">nvidia-smi</span></code></a></p></li>
</ul>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>nvidia-smi
</pre></div>
</div>
<p><img alt="Capture nvidia-smi" src="_images/nvidia-smi.png" /></p>
<ul class="simple">
<li><p>Il existe aussi un projet <a class="reference external" href="https://github.com/Syllo/nvtop"><code class="docutils literal notranslate"><span class="pre">nvtop</span></code></a>
permettant de visualiser l’utilisation d’un ou plusieurs GPU dans
un terminal :</p></li>
</ul>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exécution avec un GPU</span>
bash<span class="w"> </span>scripts/crunch.sh<span class="w"> </span>--gpu
nvtop<span class="w">  </span><span class="c1"># q pour quitter</span>
</pre></div>
</div>
<p><img alt="Capture nvtop" src="https://raw.githubusercontent.com/Syllo/nvtop/master/screenshot/NVTOP_ex1.png" /></p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Regarder le résultat</span>
grep<span class="w"> </span>sec<span class="w"> </span>tg.log

<span class="nb">exit</span><span class="w">  </span><span class="c1"># Pour revenir à login1</span>
</pre></div>
</div>
<p>Si vous utilisez
<a class="reference external" href="https://docs.alliancecan.ca/wiki/JupyterHub/fr">JupyterHub</a>
pour profiler votre programme GPU, vous pouvez visualiser en temps
réel la consommation de ressources GPU dans l’onglet <em>GPU Dashboards</em>:</p>
<p><img alt="NV Dashboard GPU" src="_images/nv-dashboard_gpu.png" /></p>
<section id="exercice-tester-crunch-py-avec-un-gpu">
<h4><strong>Exercice</strong> - Tester <code class="docutils literal notranslate"><span class="pre">crunch.py</span></code> avec un GPU<a class="headerlink" href="#exercice-tester-crunch-py-avec-un-gpu" title="Lien vers cette rubrique">#</a></h4>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w">    </span>scripts/crunch-sbatch-1gpu.sh
sbatch<span class="w"> </span>scripts/crunch-sbatch-1gpu.sh

squeue<span class="w"> </span>-u<span class="w"> </span><span class="nv">$USER</span><span class="w">  </span><span class="c1"># Pour vérifier l&#39;état de la tâche</span>
tail<span class="w"> </span>-24<span class="w"> </span><span class="k">$(</span>ls<span class="w"> </span>slurm-*<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="k">)</span>
</pre></div>
</div>
</section>
<section id="comparer-la-vitesse-cpu-vs-gpu">
<h4>Comparer la vitesse CPU vs GPU<a class="headerlink" href="#comparer-la-vitesse-cpu-vs-gpu" title="Lien vers cette rubrique">#</a></h4>
<p>Avant d’utiliser massivement les GPU d’une grappe de calcul, il faut
tout d’abord que l’application ou l’algorithme puisse démontrer une
« bonne performance » en utilisant plusieurs processeurs en parallèle.</p>
<p>Quelques définitions :</p>
<ul class="simple">
<li><p><strong>Temps écoulé</strong> = temps d’exécution total que l’on perçoit et non le temps CPU</p></li>
<li><p><strong>Accélération</strong> = (temps avec <code class="docutils literal notranslate"><span class="pre">1</span></code> processeur) / (temps avec <code class="docutils literal notranslate"><span class="pre">N</span></code> processeurs)</p></li>
<li><p><strong>Efficacité</strong> = (Accélération) / <code class="docutils literal notranslate"><span class="pre">N</span></code></p></li>
</ul>
<p>Le coût d’un noeud GPU étant huit fois (8x) supérieur à celui d’un noeud
régulier, l’utilisation d’un seul GPU doit permettre une accélération
d’au moins huit fois (8x) la vitesse de 8 à 16 processeurs.</p>
<ul class="simple">
<li><p><strong>Accélération GPU</strong> = (temps avec 8 à 16 processeur) /
(temps avec un GPU) &gt;= 8</p></li>
</ul>
</section>
</section>
<section id="analyse-des-taches-via-les-portails">
<h3>Analyse des tâches via les portails<a class="headerlink" href="#analyse-des-taches-via-les-portails" title="Lien vers cette rubrique">#</a></h3>
<p>Béluga et Narval ont chacun un portail pour l’analyse des tâches :</p>
<ul class="simple">
<li><p><a class="reference external" href="https://portail.beluga.calculquebec.ca/">https://portail.beluga.calculquebec.ca/</a></p></li>
<li><p><a class="reference external" href="https://portail.narval.calculquebec.ca/">https://portail.narval.calculquebec.ca/</a></p></li>
</ul>
</section>
</section>
<section id="estimer-les-ressources-necessaires">
<h2>Estimer les ressources nécessaires<a class="headerlink" href="#estimer-les-ressources-necessaires" title="Lien vers cette rubrique">#</a></h2>
<section id="efficacite-cible-d-une-tache">
<h3>Efficacité cible d’une tâche<a class="headerlink" href="#efficacite-cible-d-une-tache" title="Lien vers cette rubrique">#</a></h3>
<p>À coût d’essais et erreurs avec une <strong>tâche de petite taille</strong>,
la cible pour :</p>
<ul class="simple">
<li><p><strong>Le calcul</strong> est une <strong>efficacité d’au moins 90%</strong></p>
<ul>
<li><p>Tâches séquentielles : il faut <strong>optimiser les accès aux données</strong></p>
<ul>
<li><p>Utiliser adéquatement les différents types de stockage</p></li>
</ul>
</li>
<li><p>Tâches parallèles : il existe un <strong>nombre maximal de processeurs</strong>
à utiliser pour respecter ce seuil :</p>
<ul>
<li><p>Principe de <a class="reference external" href="https://docs.alliancecan.ca/wiki/Scalability/fr">scalabilité</a>
et la <a class="reference external" href="https://fr.wikipedia.org/wiki/Loi_d%27Amdahl">loi d’Amdahl</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>La mémoire-vive</strong> est une consommation <strong>de l’ordre de 80%</strong>
de ce qui est demandé à l’ordonnanceur Slurm</p></li>
</ul>
<p><strong>Rappel</strong> - vous pouvez obtenir ces pourcentages via les commandes
<code class="docutils literal notranslate"><span class="pre">sacct</span> <span class="pre">-X</span></code> (surtout pour obtenir les numéros de tâches) et <code class="docutils literal notranslate"><span class="pre">seff</span></code>.
Les valeurs à considérer sont :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CPU</span> <span class="pre">Utilized</span></code> et <code class="docutils literal notranslate"><span class="pre">CPU</span> <span class="pre">Efficiency</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Memory</span> <span class="pre">Utilized</span></code> et <code class="docutils literal notranslate"><span class="pre">Memory</span> <span class="pre">Efficiency</span></code></p></li>
</ul>
<section id="exercice-efficacite-des-taches">
<h4><strong>Exercice</strong> - Efficacité des tâches<a class="headerlink" href="#exercice-efficacite-des-taches" title="Lien vers cette rubrique">#</a></h4>
<p>Pour quelques-unes de vos tâches listées par la commande suivante :</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>sacct<span class="w"> </span>-X
</pre></div>
</div>
<p>Obtenez le <code class="docutils literal notranslate"><span class="pre">CPU</span> <span class="pre">Efficiency</span></code> et le <code class="docutils literal notranslate"><span class="pre">Memory</span> <span class="pre">Efficiency</span></code> via la commande :</p>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>seff<span class="w"> </span>&lt;No_tâche&gt;
</pre></div>
</div>
</section>
</section>
<section id="extrapoler-les-ressources-necessaires">
<h3>Extrapoler les ressources nécessaires<a class="headerlink" href="#extrapoler-les-ressources-necessaires" title="Lien vers cette rubrique">#</a></h3>
<p><strong>En augmentant la ou les dimensions du problème</strong>, quelles devraient
être la durée du calcul et la consommation en mémoire-vive?
<a class="reference external" href="https://fr.wikipedia.org/wiki/Analyse_de_la_complexit%C3%A9_des_algorithmes">Une analyse détaillée du code</a>
n’est pas nécessaire pour déterminer le type de calcul qui est fait :</p>
<ul class="simple">
<li><p>Vous pouvez <strong>mesurer le temps d’exécution</strong> (avec la
commande <code class="docutils literal notranslate"><span class="pre">time</span></code>) en fonction de la taille du problème.
En extrapolant les résultats, il serait possible de prévoir
le comportement du programme sur une grappe de calcul.</p></li>
</ul>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span><span class="nb">time</span><span class="w"> </span>-p<span class="w"> </span>sleep<span class="w"> </span><span class="m">2</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Vous pouvez considérer le <strong>format des données en entrées</strong> pour
deviner l’ordre du calcul principal.</p></li>
</ul>
</section>
<section id="taille-des-donnees-et-nombre-de-fichiers-a-traiter">
<h3>Taille des données et nombre de fichiers à traiter<a class="headerlink" href="#taille-des-donnees-et-nombre-de-fichiers-a-traiter" title="Lien vers cette rubrique">#</a></h3>
<p>En plus du temps de calcul et de l’espace mémoire, il faut aussi
considérer <strong>l’utilisation du stockage</strong>. Les valeurs à tenir compte :</p>
<ol class="arabic simple">
<li><p>La <strong>quantité</strong> en octets (ou Go)</p>
<ul class="simple">
<li><p>Peut servir à <strong>estimer</strong> l’utilisation de la mémoire-vive</p></li>
<li><p>Tenir compte de la taille du <strong>stockage local rapide</strong> pour
optimiser les accès aux fichiers</p></li>
</ul>
</li>
<li><p>Le <strong>nombre</strong> de fichiers à traiter</p>
<ul class="simple">
<li><p>Considérer le <strong>parallélisme de données</strong></p></li>
<li><p><strong>Multiplier la durée moyenne</strong> du traitement d’un fichier par
le nombre de fichiers pour estimer la durée d’une tâche</p></li>
<li><p><strong>Multiplier la taille moyenne</strong> des fichiers par leur nombre
pour estimer l’espace en mémoire-vive (par exemple : des images)</p></li>
<li><p>Utiliser le stockage rapide pour <strong>optimiser les accès</strong>
aléatoires et nombreux</p></li>
</ul>
</li>
</ol>
<p>Pour obtenir le nombre de fichiers et la taille totale :</p>
<ul class="simple">
<li><p><strong>Sous Windows</strong> : dans l’explorateur Windows (raccourcis clavier : Windows + E)</p>
<ul>
<li><p>Sélectionner un dossier ou plusieurs fichiers</p></li>
<li><p>Bouton droit de la souris -&gt; <em>Propriétés</em></p></li>
</ul>
</li>
</ul>
<p><img alt="Windows data properties" src="_images/win-data-size.png" /></p>
<ul class="simple">
<li><p><strong>Sous macOS</strong> : dans <em>Finder</em></p>
<ul>
<li><p>Sélectionner un dossier ou plusieurs fichiers</p></li>
<li><p>Bouton droit de la souris -&gt; <em>Get Info</em></p></li>
<li><p>Autrement : avec l’affichage <em>Par liste</em></p>
<ul>
<li><p><a class="reference external" href="https://www.solutionenligne.org/comment-afficher-taille-dossiers-fichiers-dans-finder-mac-os/">Activer <em>Calculer toutes les tailles</em></a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p><strong>Sous Linux</strong> et sur les <strong>grappes de calcul</strong> :</p>
<ul>
<li><p>L’environnement graphique peut offrir le même genre d’outils,
mais tout dépend de la distribution et du bureau.</p></li>
<li><p>La commande <code class="docutils literal notranslate"><span class="pre">du</span> <span class="pre">-sb</span> <span class="pre">RÉPERTOIRE</span></code> (<code class="docutils literal notranslate"><span class="pre">s</span></code> : somme totale, <code class="docutils literal notranslate"><span class="pre">b</span></code> :
taille apparente en octets) calcule récursivement et affiche
la taille totale en octets. La taille apparente est celle qui
importe lors d’un transfert ou d’une sauvegarde de données.</p></li>
<li><p>La commande <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">RÉPERTOIRE</span> <span class="pre">|</span> <span class="pre">wc</span> <span class="pre">-l</span></code> compte récursivement
et affiche le nombre de fichiers et de sous-répertoires.</p></li>
</ul>
</li>
</ul>
<div class="highlight-Bash notranslate"><div class="highlight"><pre><span></span>du<span class="w"> </span>-sb<span class="w"> </span>donnees
find<span class="w"> </span>donnees<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
</pre></div>
</div>
</section>
</section>
<section id="comparaison-entre-les-grappes-de-calcul">
<h2>Comparaison entre les grappes de calcul<a class="headerlink" href="#comparaison-entre-les-grappes-de-calcul" title="Lien vers cette rubrique">#</a></h2>
<ul class="simple">
<li><p>À propos des grappes :</p></li>
</ul>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-right"><p></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/B%C3%A9luga">Béluga</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Cedar/fr">Cedar</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Graham/fr">Graham</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Narval">Narval</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Niagara/fr">Niagara</a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p><strong>Mise en production</strong></p></td>
<td class="text-center"><p>Mars 2019</p></td>
<td class="text-center"><p>Juin 2017</p></td>
<td class="text-center"><p>Juin 2017</p></td>
<td class="text-center"><p>Octobre 2021</p></td>
<td class="text-center"><p>Avril 2018</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p><strong>Ville</strong></p></td>
<td class="text-center"><p>Montréal</p></td>
<td class="text-center"><p>Burnaby</p></td>
<td class="text-center"><p>Waterloo</p></td>
<td class="text-center"><p>Montréal</p></td>
<td class="text-center"><p>Toronto</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p><strong>Province</strong></p></td>
<td class="text-center"><p>Québec</p></td>
<td class="text-center"><p>C.-B.</p></td>
<td class="text-center"><p>Ontario</p></td>
<td class="text-center"><p>Québec</p></td>
<td class="text-center"><p>Ontario</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p>Nombre de processeurs (coeurs CPU) selon le cas :</p></li>
</ul>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-right"><p>Processeur Intel/AMD</p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/B%C3%A9luga">Béluga</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Cedar/fr">Cedar</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Graham/fr">Graham</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Narval">Narval</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Niagara/fr">Niagara</a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>Broadwell (avx2)</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>724 * 32</p></td>
<td class="text-center"><p>983 * 32</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>Skylake (avx512)</p></td>
<td class="text-center"><p>802 * 40</p></td>
<td class="text-center"><p>640 * 48</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>1548 * 40</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>Cascade Lake (avx512)</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>768 * 48</p></td>
<td class="text-center"><p>136 * 44</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>476 * 40</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>EPYC Rome (avx2)</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>1181 * 64</p></td>
<td class="text-center"><p></p></td>
</tr>
</tbody>
</table>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-right"><p>Mémoire par proc.</p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/B%C3%A9luga">Béluga</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Cedar/fr">Cedar</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Graham/fr">Graham</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Narval">Narval</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Niagara/fr">Niagara</a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>2400M</p></td>
<td class="text-center"><p>160 * 40</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>4000M</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>1408 * 48</p></td>
<td class="text-center"><p>903 * 32</p></td>
<td class="text-center"><p>1145 * 64</p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>4000M</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>576 * 32</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>4400M</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>136 * 44</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>4800M</p></td>
<td class="text-center"><p>589 * 40</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>2024 * 40</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>8000M</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>96 * 32</p></td>
<td class="text-center"><p>56 * 32</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>16000M</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>24 * 32</p></td>
<td class="text-center"><p>24 * 32</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>19200M</p></td>
<td class="text-center"><p>53 * 40</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>32000M</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>36 * 64</p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>48000M</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>24 * 32</p></td>
<td class="text-center"><p>3 * 64</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>96000M</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>4 * 32</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Using_GPUs_with_Slurm/fr">Nombre de GPU</a> selon le cas :</p></li>
</ul>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-right"><p>Accélérateurs</p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/B%C3%A9luga">Béluga</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Cedar/fr">Cedar</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Graham/fr">Graham</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.scinet.utoronto.ca/index.php/Mist">Mist (Power9)</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Narval">Narval</a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>NVIDIA P100 12G</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>456</p></td>
<td class="text-center"><p>320</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>NVIDIA P100 16G</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>128</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>NVIDIA T4 16G</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>144</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>NVIDIA V100 16G</p></td>
<td class="text-center"><p>688</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>54</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>NVIDIA V100 32G</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>768</p></td>
<td class="text-center"><p>16</p></td>
<td class="text-center"><p>216</p></td>
<td class="text-center"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>NVIDIA A100 40G</p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p></p></td>
<td class="text-center"><p>636</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p>Réseau haute-performance et ordonnancement :</p></li>
</ul>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-right"><p></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/B%C3%A9luga">Béluga</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Cedar/fr">Cedar</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Graham/fr">Graham</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Narval">Narval</a></p></th>
<th class="head text-center"><p><a class="reference external" href="https://docs.alliancecan.ca/wiki/Niagara/fr">Niagara</a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>Connexion rapide</p></td>
<td class="text-center"><p>InfiniBand</p></td>
<td class="text-center"><p>OmniPath</p></td>
<td class="text-center"><p>InfiniBand</p></td>
<td class="text-center"><p>InfiniBand</p></td>
<td class="text-center"><p>InfiniBand</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>Topologie</p></td>
<td class="text-center"><p>En arbre</p></td>
<td class="text-center"><p>En arbre</p></td>
<td class="text-center"><p>En arbre</p></td>
<td class="text-center"><p>En arbre</p></td>
<td class="text-center"><p>DragonFly+</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>Taille îlots (proc)</p></td>
<td class="text-center"><p>640 à 1200</p></td>
<td class="text-center"><p>1024 à 1536</p></td>
<td class="text-center"><p>1024</p></td>
<td class="text-center"><p>3072 à 3584</p></td>
<td class="text-center"><p>17280</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>Facteur de blockage</p></td>
<td class="text-center"><p>max 5:1</p></td>
<td class="text-center"><p>max 2:1</p></td>
<td class="text-center"><p>max 8:1</p></td>
<td class="text-center"><p>max 4.7:1</p></td>
<td class="text-center"><p>max 2:1</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>Granularité des tâches (par)</p></td>
<td class="text-center"><p>proc, GPU</p></td>
<td class="text-center"><p>proc, GPU</p></td>
<td class="text-center"><p>proc, GPU</p></td>
<td class="text-center"><p>proc, GPU</p></td>
<td class="text-center"><p>noeud</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>Durée maximale</p></td>
<td class="text-center"><p>7 jours</p></td>
<td class="text-center"><p>28 jours</p></td>
<td class="text-center"><p>7 jours</p></td>
<td class="text-center"><p>7 jours</p></td>
<td class="text-center"><p>1 jour</p></td>
</tr>
</tbody>
</table>
</div>
<ul class="simple">
<li><p>Stockage : le tout sera décrit au dernier chapitre.</p></li>
</ul>
</section>
<section id="points-a-retenir">
<h2>Points à retenir<a class="headerlink" href="#points-a-retenir" title="Lien vers cette rubrique">#</a></h2>
<ul class="simple">
<li><p>Prévoir les <strong>paramètres d’une tâche Slurm</strong></p>
<ul>
<li><p>Nombre de processeurs (CPU) et de noeuds de calcul</p></li>
<li><p>Nombre d’accélérateurs (GPU)</p></li>
<li><p>Quantité de mémoire-vive (RAM)</p></li>
<li><p>Temps du calcul (<code class="docutils literal notranslate"><span class="pre">JJ-H:M</span></code> ou <code class="docutils literal notranslate"><span class="pre">H:M:S</span></code>)</p></li>
</ul>
</li>
<li><p>Différents <strong>outils pour monitorer</strong> les ressources utilisées</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">time</span></code> et autres bibliothèques de mesure du temps écoulé</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">top</span></code>, <code class="docutils literal notranslate"><span class="pre">htop</span></code>, <code class="docutils literal notranslate"><span class="pre">nvtop</span></code>, <code class="docutils literal notranslate"><span class="pre">nvidia-smi</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sacct</span></code>, <code class="docutils literal notranslate"><span class="pre">seff</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">du</span> <span class="pre">-sb</span></code>, <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">|</span> <span class="pre">wc</span> <span class="pre">-l</span></code> et autres outils du système d’exploitation</p></li>
</ul>
</li>
<li><p>On vise une <strong>efficacité de 90%</strong> et plus pour les tâches CPU</p>
<ul>
<li><p>L’accélération avec un accélérateur (GPU) doit être significative (&gt;8x)</p></li>
</ul>
</li>
<li><p>Le choix de la grappe dépend des besoins de chaque type de calcul</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="1-introduction.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">précédent</p>
        <p class="prev-next-title">Introduction</p>
      </div>
    </a>
    <a class="right-next"
       href="3-lots-taches.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">suivant</p>
        <p class="prev-next-title">Lots de tâches</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contenu
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#objectif-construction-d-un-script-de-tache-slurm">Objectif - construction d’un script de tâche Slurm</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analyse-des-calculs-localement">Analyse des calculs localement</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sous-windows">Sous Windows</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sous-macos">Sous macOS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sous-linux">Sous Linux</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analyse-des-taches-sur-la-grappe-de-calcul">Analyse des tâches sur la grappe de calcul</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ressources-utilisees-d-une-tache-terminee">Ressources utilisées d’une tâche terminée</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ressources-utilisees-par-une-tache-cpu-en-cours">Ressources utilisées par une tâche CPU en cours</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exercice-valider-le-comportement-d-une-tache-active"><strong>Exercice</strong> - Valider le comportement d’une tâche active</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#demo-ressources-utilisees-par-une-tache-gpu-en-cours">(Démo) Ressources utilisées par une tâche GPU en cours</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exercice-tester-crunch-py-avec-un-gpu"><strong>Exercice</strong> - Tester <code class="docutils literal notranslate"><span class="pre">crunch.py</span></code> avec un GPU</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#comparer-la-vitesse-cpu-vs-gpu">Comparer la vitesse CPU vs GPU</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analyse-des-taches-via-les-portails">Analyse des tâches via les portails</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimer-les-ressources-necessaires">Estimer les ressources nécessaires</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#efficacite-cible-d-une-tache">Efficacité cible d’une tâche</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exercice-efficacite-des-taches"><strong>Exercice</strong> - Efficacité des tâches</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extrapoler-les-ressources-necessaires">Extrapoler les ressources nécessaires</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#taille-des-donnees-et-nombre-de-fichiers-a-traiter">Taille des données et nombre de fichiers à traiter</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparaison-entre-les-grappes-de-calcul">Comparaison entre les grappes de calcul</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#points-a-retenir">Points à retenir</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
Par Équipe Calcul Québec
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>